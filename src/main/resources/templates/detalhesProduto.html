<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />


  <title>Pi Z - Home</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant:ital,wght@0,300..700;1,300..700&display=swap"
    rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Link Swiper's CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <!-- CSS -->
  <link rel="stylesheet" href="/css/detalhesProduto.css" />

</head>

<body style="background-color: #FAFAFA;">

    <!-- Insere o cabeçalho separado em outro arquivo -->
    <header th:replace="~{fragments/menuNavegacao :: menuNavegacao}"></header>

    <div class="container-produto">
        <div class="product-container">
            <!-- Seção da Imagem do Produto -->
            <div class="product-image-section">
                <div class="main-image-wrapper">
                    <!-- Imagem principal do produto -->
                    <img th:src="${produto.imgUrl}" alt="Sandália Pierre Salto Alto Fino" class="main-image">
                </div>
            </div>
            <!-- Seção de Detalhes do Produto -->
            <div class="product-details-section">
                <h1 class="product-title" th:text="${produto.nome}"></h1>
                <p class="release-info" th:text="${produto.colecao}"></p>
    
                <p class="sizes-label">Tamanhos:</p>
                <div class="size-options">
                    <div th:each="tamanhoProduto : ${tamanhosDisponiveis}"
                         th:classappend="${tamanhoProduto.id == produto.id} ? 'selected' : ''"
                         th:text="${tamanhoProduto.tamanho}"
                         class="size-option"
                         th:data-produto-id="${tamanhoProduto.id}">
                        </div>
                </div>
    
                <p class="price" th:text="'R$' + ${#numbers.formatDecimal(produto.preco, 1, 'COMMA', 2, 'POINT')}"></p>
    
                <div class="actions">
                    <form th:action="@{/carrinho/adicionar}" method="post">
                        <input type="hidden" name="idProdutoEscolhido" id="tamanhoSelecionadoInput"/>
                        <button type="submit" class="buy-button">Comprar</button>
                    </form>
                </div>
    
                <p class="delivery-info">
                    PREVISÃO DE ENTREGA<br>
                    <span th:text="${previsaoInicio}"></span> - <span th:text="${previsaoFim}"></span>
                </p>
            </div>
        </div>
    </div>

    <!-- Insere o rodapé separado em outro arquivo -->
    <footer th:replace="~{fragments/rodape :: rodape}"></footer>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Adiciona um evento de escuta para quando o DOM estiver completamente carregado
        document.addEventListener('DOMContentLoaded', function() {
            // Seleciona todas as opções de tamanho
            const sizeOptions = document.querySelectorAll('.size-option');
            // Seleciona o input oculto onde o tamanho selecionado será armazenado
            const tamanhoSelecionadoInput = document.getElementById('tamanhoSelecionadoInput');
    
            // Função para atualizar a seleção visual (classe 'selected')
            // e o valor do input oculto com o ID da variação do produto.
            function updateSelectedSize(selectedElement) {
                // Remove a classe 'selected' de TODAS as opções de tamanho
                sizeOptions.forEach(option => option.classList.remove('selected'));
                
                // Adiciona a classe 'selected' APENAS à opção clicada/selecionada
                selectedElement.classList.add('selected');
                tamanhoSelecionadoInput.value = selectedElement.dataset.produtoId;
            }
    
            // Adiciona um listener de clique a CADA opção de tamanho
            sizeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Quando uma opção é clicada, chamamos a função para atualizar
                    updateSelectedSize(this);
                });
            });
    
            // Lógica para definir um tamanho padrão ao carregar a página:
            // 1. Tenta encontrar uma opção que já tenha a classe 'selected' (definida pelo Thymeleaf)
            const defaultSelected = document.querySelector('.size-option.selected');
            
            if (defaultSelected) {
                // Se encontrou, atualiza o estado (visual e input oculto) para essa opção
                updateSelectedSize(defaultSelected);
            } else if (sizeOptions.length > 0) {
                // Se NENHUMA opção tem 'selected' (e há opções de tamanho disponíveis),
                // seleciona a PRIMEIRA opção como padrão.
                updateSelectedSize(sizeOptions[0]);
            }
        });
    </script>
</body>